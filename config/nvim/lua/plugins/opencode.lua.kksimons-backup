-- ============================================================================
-- OpenCode.nvim Configuration
-- Generated by: Trinitas System (Artemis + Hestia)
-- Date: 2025-10-27
-- Security Level: MEDIUM RISK - Monitored Installation
--
-- Plugin: kksimons/nvim-opencode (Simple & Safe approach)
-- Rationale:
--   - Minimal dependencies
--   - Clear separation from LazyVim core
--   - Easy rollback capability
--   - Low complexity = Low risk
-- ============================================================================

return {
  {
    -- Simple OpenCode integration for Neovim
    "kksimons/nvim-opencode",

    -- Lazy loading - only load when explicitly called
    cmd = {
      "OpencodeStart",
      "OpencodeStop",
      "OpencodeToggle",
    },

    -- Configuration
    config = function()
      require('nvim-opencode').setup({
        -- Auto-start disabled for security
        -- User must explicitly invoke OpenCode
        auto_start = false,

        -- Terminal layout
        terminal_mode = 'vertical',  -- 'horizontal', 'vertical', 'float'
        terminal_size = 80,          -- Width in columns (vertical mode)

        -- OpenCode CLI path (auto-detected by default)
        -- opencode_path = '/opt/homebrew/bin/opencode',  -- Uncomment if auto-detection fails
      })
    end,

    -- Keymaps (LazyVim style)
    keys = {
      {
        "<leader>oc",
        "<cmd>OpencodeStart<cr>",
        desc = "OpenCode: Start",
      },
      {
        "<leader>ox",
        "<cmd>OpencodeStop<cr>",
        desc = "OpenCode: Stop",
      },
      {
        "<leader>ot",
        "<cmd>OpencodeToggle<cr>",
        desc = "OpenCode: Toggle",
      },
    },
  },

  -- ========================================================================
  -- Alternative Options (Commented Out)
  -- ========================================================================

  -- Option B: Advanced integration with Telescope picker
  -- Uncomment if you need more advanced features
  --[[
  {
    "sudo-tee/opencode.nvim",
    dependencies = {
      "nvim-telescope/telescope.nvim",
    },
    cmd = {
      "Opencode",
      "OpencodeAddFile",
      "OpencodeRemoveFile",
    },
    config = function()
      require('opencode').setup({
        preferred_picker = 'telescope',
        default_mode = 'build',
        keymap_prefix = '<leader>o',

        terminal = {
          position = 'right',
          size = 0.4,
        },

        auto_commands = {
          save_on_send = true,
          reload_on_change = true,
        },
      })
    end,
  },
  ]]--

  -- Option C: Snacks.nvim integration
  -- Uncomment if you prefer native LazyVim integration
  --[[
  {
    "NickvanDyke/opencode.nvim",
    dependencies = {
      {
        "folke/snacks.nvim",
        opts = {
          input = {},
          picker = {},
        },
      },
    },
    cmd = {
      "Opencode",
      "OpencodeAddFile",
      "OpencodeClose",
    },
    config = function()
      vim.g.opencode_opts = {
        terminal_height = 20,
        auto_start = false,
      }

      vim.o.autoread = true
    end,
    keys = {
      { "<leader>oc", "<cmd>Opencode<cr>", desc = "OpenCode: Open" },
      { "<leader>oa", "<cmd>OpencodeAddFile<cr>", desc = "OpenCode: Add File" },
      { "<leader>ox", "<cmd>OpencodeClose<cr>", desc = "OpenCode: Close" },
    },
  },
  ]]--
}
