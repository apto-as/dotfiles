-- ============================================================================
-- OpenCode.nvim - Production-Grade Configuration
-- ============================================================================
-- Environment:
--   Neovim: 0.11.4
--   LazyVim: Active
--   OpenCode CLI: 0.15.18
--   Plugin: NickvanDyke/opencode.nvim (æœ€æ¨å¥¨å®Ÿè£…)
--
-- Generated by: Trinitas System (Artemis - Technical Perfectionist)
-- Date: 2025-10-28
-- Quality: Production-Ready
-- Security: MEDIUM RISK - Approved
-- ============================================================================

return {
  {
    "NickvanDyke/opencode.nvim",

    -- ========================================================================
    -- ä¾å­˜é–¢ä¿‚è¨­å®š
    -- ========================================================================
    dependencies = {
      {
        "folke/snacks.nvim",
        opts = {
          input = {},    -- ask()æ©Ÿèƒ½ã§å¿…è¦
          picker = {},   -- select()æ©Ÿèƒ½ã§å¿…è¦
          terminal = {}, -- toggle()æ©Ÿèƒ½ã§å¿…è¦
        },
      },
    },

    -- ========================================================================
    -- é…å»¶èª­ã¿è¾¼ã¿ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰
    -- ========================================================================
    cmd = {
      "OpencodePrompt",
      "OpencodeAsk",
      "OpencodeSelect",
      "OpencodeCommand",
      "OpencodeToggle",
    },

    -- ========================================================================
    -- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åˆæœŸåŒ–è¨­å®š
    -- ========================================================================
    config = function()
      -- OpenCodeè¨­å®š
      vim.g.opencode_opts = {
        -- ====================================================================
        -- ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®šï¼ˆsnacks.nvimçµ±åˆï¼‰
        -- ====================================================================
        provider = {
          enabled = "snacks", -- LazyVimæ¨™æº–ã®snacks.nvimä½¿ç”¨

          snacks = {
            win = {
              position = "right", -- å³å´ã«é…ç½®
              width = 0.4, -- ç”»é¢å¹…ã®40%
              height = 1.0, -- ç”»é¢é«˜ã•ã®100%
              border = "rounded", -- è§’ä¸¸ãƒœãƒ¼ãƒ€ãƒ¼
            },
            -- ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³
            bo = {
              filetype = "opencode",
            },
            wo = {
              winhighlight = "Normal:Normal,FloatBorder:FloatBorder",
            },
          },
        },

        -- ====================================================================
        -- è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰è¨­å®š
        -- ====================================================================
        auto_reload = true, -- OpenCodeãŒãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã«è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰

        -- ====================================================================
        -- ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®šç¾©ï¼ˆæ‹¡å¼µå¯èƒ½ï¼‰
        -- ====================================================================
        prompts = {
          -- åŸºæœ¬ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆçµ„ã¿è¾¼ã¿ï¼‰
          explain = {
            prompt = "Explain @this in detail",
            description = "Explain code",
          },
          optimize = {
            prompt = "Optimize @this for performance and readability",
            description = "Optimize code",
          },
          document = {
            prompt = "Add detailed documentation to @this",
            description = "Document code",
          },
          test = {
            prompt = "Generate comprehensive tests for @this",
            description = "Generate tests",
          },
          review = {
            prompt = "Review @this for bugs and improvements",
            description = "Code review",
          },

          -- ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆArtemisæ¨å¥¨ï¼‰
          security_audit = {
            prompt = [[
Perform a comprehensive security audit of @this:
1. Identify potential vulnerabilities
2. Check for SQL injection, XSS, CSRF risks
3. Validate input sanitization
4. Review authentication/authorization
5. Suggest security improvements with concrete code examples
]],
            description = "Security audit",
          },

          performance_profile = {
            prompt = [[
Analyze @this for performance bottlenecks:
1. Identify time complexity issues (target: O(n) or better)
2. Check for N+1 database queries
3. Review memory usage patterns
4. Suggest caching opportunities
5. Recommend specific optimization strategies with benchmarks
]],
            description = "Performance profiling",
          },

          refactor = {
            prompt = [[
Suggest refactoring improvements for @this:
1. Identify code smells (duplicated code, long methods, etc.)
2. Check for SOLID principle violations
3. Suggest applicable design patterns
4. Improve readability and maintainability
5. Reduce cyclomatic complexity (target: < 10)
]],
            description = "Refactoring suggestions",
          },

          type_safety = {
            prompt = [[
Review @this for type safety:
1. Identify missing type annotations
2. Check for implicit Any/Dynamic types
3. Validate type compatibility
4. Suggest strict type improvements
5. Check for null/undefined safety issues
]],
            description = "Type safety review",
          },

          architecture_review = {
            prompt = [[
Review @this from architectural perspective:
1. Evaluate separation of concerns
2. Check dependency direction (follow dependency rule)
3. Identify architectural violations
4. Suggest layer/module improvements
5. Assess testability and maintainability
]],
            description = "Architecture review",
          },
        },

        -- ====================================================================
        -- ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆè‡ªå‹•åŒ–ï¼‰
        -- ====================================================================
        on_event = function(event)
          -- ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†é€šçŸ¥
          if event.type == "session.idle" then
            vim.notify("âœ… OpenCode session completed", vim.log.levels.INFO)
          end

          -- ã‚¨ãƒ©ãƒ¼é€šçŸ¥
          if event.type == "session.error" then
            vim.notify("âš ï¸ OpenCode error: " .. vim.inspect(event), vim.log.levels.WARN)
          end

          -- ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹é€šçŸ¥
          if event.type == "session.started" then
            vim.notify("ğŸš€ OpenCode session started", vim.log.levels.INFO)
          end
        end,
      }

      -- ======================================================================
      -- ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šï¼ˆNeovimï¼‰
      -- ======================================================================

      -- è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–ï¼ˆOpenCodeã®ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’è‡ªå‹•åæ˜ ï¼‰
      vim.o.autoread = true

      -- ======================================================================
      -- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šï¼ˆæ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ç„¡åŠ¹åŒ–ï¼‰
      -- ======================================================================
      vim.api.nvim_create_autocmd("BufEnter", {
        pattern = {
          "*.env",
          "*.env.*",
          "*.key",
          "*.pem",
          "*.secret",
          "*secret*",
          "*password*",
          "*.credentials",
        },
        callback = function()
          vim.b.opencode_disabled = true
          vim.notify(
            "âš ï¸ OpenCode disabled (sensitive file detected)",
            vim.log.levels.WARN
          )
        end,
        desc = "Disable OpenCode in sensitive files",
      })

      -- ======================================================================
      -- è‡ªå‹•åŒ–: ä¿å­˜æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
      -- ======================================================================
      -- vim.api.nvim_create_autocmd("BufWritePost", {
      --   callback = function()
      --     -- LSPè¨ºæ–­ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡º
      --     local diagnostics = vim.diagnostic.get(0, {
      --       severity = vim.diagnostic.severity.ERROR,
      --     })
      --
      --     if #diagnostics > 0 then
      --       -- ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆã€ä¿®æ­£ã‚’ææ¡ˆ
      --       local choice = vim.fn.confirm(
      --         string.format(
      --           "%d errors detected. Send to OpenCode for fix?",
      --           #diagnostics
      --         ),
      --         "&Yes\n&No",
      --         2
      --       )
      --       if choice == 1 then
      --         require("opencode").prompt("Fix @diagnostics", { submit = true })
      --       end
      --     end
      --   end,
      --   desc = "Auto-suggest OpenCode fix on errors",
      -- })

      -- ======================================================================
      -- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆæ‹¡å¼µä¾‹ï¼‰
      -- ======================================================================
      vim.api.nvim_create_autocmd("User", {
        pattern = "OpencodeEvent",
        callback = function(args)
          local event = args.data.event

          -- ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã®è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰
          if event.type == "file.changed" then
            vim.cmd("checktime") -- ãƒãƒƒãƒ•ã‚¡ãƒªãƒ­ãƒ¼ãƒ‰
            vim.notify("ğŸ”„ File reloaded by OpenCode", vim.log.levels.INFO)
          end

          -- è¨±å¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€šçŸ¥
          if event.type == "permission.requested" then
            vim.notify(
              "ğŸ” OpenCode requesting permission: " .. vim.inspect(event.data),
              vim.log.levels.WARN
            )
          end
        end,
        desc = "OpenCode event handler",
      })
    end,

    -- ========================================================================
    -- ã‚­ãƒ¼ãƒãƒƒãƒ—è¨­å®šï¼ˆLazyVimæ¨™æº–ï¼‰
    -- ========================================================================
    keys = {
      -- ====================================================================
      -- åŸºæœ¬æ“ä½œ
      -- ====================================================================

      -- OpenCodeãƒˆã‚°ãƒ«
      {
        "<leader>ot",
        function()
          require("opencode").toggle()
        end,
        desc = "OpenCode: Toggle terminal",
      },

      -- ã‚¯ã‚¤ãƒƒã‚¯è³ªå•ï¼ˆé¸æŠç¯„å›²/ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ï¼‰
      {
        "<leader>oa",
        function()
          require("opencode").ask("@this: ", { submit = true })
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Ask about @this",
      },

      -- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼
      {
        "<leader>os",
        function()
          require("opencode").select()
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Select prompt",
      },

      -- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé€ä¿¡
      {
        "<leader>o+",
        function()
          require("opencode").prompt("@this")
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Send @this to context",
      },

      -- ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
      {
        "<leader>oc",
        function()
          require("opencode").command()
        end,
        desc = "OpenCode: Execute command",
      },

      -- ====================================================================
      -- çµ„ã¿è¾¼ã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆå¤§æ–‡å­—ã‚­ãƒ¼ï¼‰
      -- ====================================================================

      -- Explainï¼ˆèª¬æ˜ï¼‰
      {
        "<leader>oE",
        function()
          require("opencode").prompt("Explain @this in detail", { submit = true })
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Explain code",
      },

      -- Optimizeï¼ˆæœ€é©åŒ–ï¼‰
      {
        "<leader>oO",
        function()
          require("opencode").prompt(
            "Optimize @this for performance and readability",
            { submit = true }
          )
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Optimize code",
      },

      -- Testï¼ˆãƒ†ã‚¹ãƒˆç”Ÿæˆï¼‰
      {
        "<leader>oT",
        function()
          require("opencode").prompt("Generate comprehensive tests for @this", {
            submit = true,
          })
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Generate tests",
      },

      -- Documentï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ï¼‰
      {
        "<leader>oD",
        function()
          require("opencode").prompt("Add detailed documentation to @this", {
            submit = true,
          })
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Document code",
      },

      -- Reviewï¼ˆã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
      {
        "<leader>oR",
        function()
          require("opencode").prompt("Review @this for bugs and improvements", {
            submit = true,
          })
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Review code",
      },

      -- ====================================================================
      -- ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆArtemisæ¨å¥¨ï¼‰
      -- ====================================================================

      -- Security Audit
      {
        "<leader>oS",
        function()
          require("opencode").prompt(
            vim.g.opencode_opts.prompts.security_audit.prompt,
            { submit = true }
          )
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Security Audit",
      },

      -- Performance Profile
      {
        "<leader>oP",
        function()
          require("opencode").prompt(
            vim.g.opencode_opts.prompts.performance_profile.prompt,
            { submit = true }
          )
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Performance Profile",
      },

      -- Refactor
      {
        "<leader>oM",
        function()
          require("opencode").prompt(
            vim.g.opencode_opts.prompts.refactor.prompt,
            { submit = true }
          )
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Refactor Suggestions",
      },

      -- Type Safety
      {
        "<leader>oY",
        function()
          require("opencode").prompt(
            vim.g.opencode_opts.prompts.type_safety.prompt,
            { submit = true }
          )
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Type Safety Review",
      },

      -- Architecture Review
      {
        "<leader>oA",
        function()
          require("opencode").prompt(
            vim.g.opencode_opts.prompts.architecture_review.prompt,
            { submit = true }
          )
        end,
        mode = { "n", "x" },
        desc = "OpenCode: Architecture Review",
      },

      -- ====================================================================
      -- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹æ“ä½œ
      -- ====================================================================

      -- Fix Diagnosticsï¼ˆLSPã‚¨ãƒ©ãƒ¼ä¿®æ­£ï¼‰
      {
        "<leader>oF",
        function()
          require("opencode").prompt("Fix @diagnostics", { submit = true })
        end,
        desc = "OpenCode: Fix LSP diagnostics",
      },

      -- Review Git Diff
      {
        "<leader>oG",
        function()
          require("opencode").prompt("Review @diff", { submit = true })
        end,
        desc = "OpenCode: Review git diff",
      },

      -- Explain Diagnostics
      {
        "<leader>oX",
        function()
          require("opencode").prompt("Explain @diagnostics in detail", {
            submit = true,
          })
        end,
        desc = "OpenCode: Explain diagnostics",
      },

      -- ====================================================================
      -- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
      -- ====================================================================

      -- New Session
      {
        "<leader>oN",
        function()
          require("opencode").command("session_new")
        end,
        desc = "OpenCode: New session",
      },

      -- Interrupt Session
      {
        "<leader>oI",
        function()
          require("opencode").command("session_interrupt")
        end,
        desc = "OpenCode: Interrupt session",
      },

      -- Compact Session
      {
        "<leader>oK",
        function()
          require("opencode").command("session_compact")
        end,
        desc = "OpenCode: Compact session history",
      },

      -- Copy Messages
      {
        "<leader>oC",
        function()
          require("opencode").command("messages_copy")
        end,
        desc = "OpenCode: Copy messages",
      },
    },
  },

  -- ==========================================================================
  -- ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ‹¡å¼µ: blink.cmpçµ±åˆï¼ˆè‡ªå‹•è£œå®Œå¼·åŒ–ï¼‰
  -- ==========================================================================
  {
    "saghen/blink.cmp",
    optional = true,
    opts = function(_, opts)
      -- OpenCodeã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è£œå®Œã‚’æœ‰åŠ¹åŒ–
      -- ask()ä½¿ç”¨æ™‚ã«@buffer, @selectionç­‰ãŒè£œå®Œã•ã‚Œã‚‹
      opts.sources = opts.sources or {}

      -- OpenCodeã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ 
      if not vim.tbl_contains(opts.sources, { name = "opencode" }) then
        table.insert(opts.sources, { name = "opencode" })
      end

      return opts
    end,
  },

  -- ==========================================================================
  -- ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ‹¡å¼µ: grapple.nvimçµ±åˆï¼ˆã‚¿ã‚°ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰
  -- ==========================================================================
  -- {
  --   "cbochs/grapple.nvim",
  --   optional = true,
  --   -- grapple.nvimã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€@grappleãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãŒä½¿ç”¨å¯èƒ½
  --   -- è¨­å®šã¯ä¸è¦ã€è‡ªå‹•æ¤œå‡ºã•ã‚Œã‚‹
  -- },
}

-- ============================================================================
-- ä½¿ç”¨æ–¹æ³• / Usage Examples
-- ============================================================================
--[[

## åŸºæœ¬çš„ãªä½¿ã„æ–¹

### 1. OpenCodeã‚’é–‹ã
ã‚­ãƒ¼: `<leader>ot`

### 2. ã‚¯ã‚¤ãƒƒã‚¯è³ªå•ï¼ˆé¸æŠç¯„å›²/ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ï¼‰
1. ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§ã‚³ãƒ¼ãƒ‰ã‚’é¸æŠ
2. ã‚­ãƒ¼: `<leader>oa`
3. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›: "@this: ãªãœã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã‹ï¼Ÿ"

### 3. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼
ã‚­ãƒ¼: `<leader>os`
â†’ çµ„ã¿è¾¼ã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹

## ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼

| ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ | èª¬æ˜ |
|---------------|------|
| `@buffer`     | ç¾åœ¨ã®ãƒãƒƒãƒ•ã‚¡å…¨ä½“ |
| `@buffers`    | å…¨ã¦ã®é–‹ã„ã¦ã„ã‚‹ãƒãƒƒãƒ•ã‚¡ |
| `@cursor`     | ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®æƒ…å ± |
| `@selection`  | ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«é¸æŠç¯„å›² |
| `@this`       | é¸æŠç¯„å›²ã¾ãŸã¯ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ï¼ˆè‡ªå‹•åˆ¤å®šï¼‰ |
| `@visible`    | ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒ†ã‚­ã‚¹ãƒˆ |
| `@diagnostics`| LSPè¨ºæ–­æƒ…å ± |
| `@quickfix`   | QuickFixãƒªã‚¹ãƒˆ |
| `@diff`       | Gitå·®åˆ† |
| `@grapple`    | grapple.nvimã‚¿ã‚°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |

## æ¨å¥¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 1. ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼
1. å¤‰æ›´ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’é¸æŠ
2. `<leader>oR` ï¼ˆReviewï¼‰
3. OpenCodeãŒå“è³ªã€ãƒã‚°ã€æ”¹å–„ç‚¹ã‚’æŒ‡æ‘˜

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
1. é…ã„ã‚³ãƒ¼ãƒ‰ã‚’é¸æŠ
2. `<leader>oP` ï¼ˆPerformance Profileï¼‰
3. ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®šã¨æœ€é©åŒ–æ¡ˆã‚’å–å¾—

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
1. èªè¨¼ãƒ»èªå¯ã‚³ãƒ¼ãƒ‰ã‚’é¸æŠ
2. `<leader>oS` ï¼ˆSecurity Auditï¼‰
3. è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯ã¨å¯¾ç­–ã‚’å–å¾—

### 4. LSPã‚¨ãƒ©ãƒ¼ä¿®æ­£
1. ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹çŠ¶æ…‹ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
2. `<leader>oF` ï¼ˆFix Diagnosticsï¼‰
3. è‡ªå‹•ä¿®æ­£æ¡ˆã‚’å–å¾—

### 5. Gitå·®åˆ†ãƒ¬ãƒ“ãƒ¥ãƒ¼
1. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆå‰ã«
2. `<leader>oG` ï¼ˆReview Diffï¼‰
3. å¤‰æ›´å†…å®¹ã®å¦¥å½“æ€§ã‚’ç¢ºèª

## ã‚­ãƒ¼ãƒãƒƒãƒ—ä¸€è¦§

| ã‚­ãƒ¼ | ãƒ¢ãƒ¼ãƒ‰ | æ©Ÿèƒ½ |
|------|-------|------|
| `<leader>ot` | n | OpenCodeãƒˆã‚°ãƒ« |
| `<leader>oa` | n, x | ã‚¯ã‚¤ãƒƒã‚¯è³ªå• |
| `<leader>os` | n, x | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé¸æŠ |
| `<leader>o+` | n, x | ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé€ä¿¡ |
| `<leader>oc` | n | ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ |
| `<leader>oE` | n, x | Explainï¼ˆèª¬æ˜ï¼‰ |
| `<leader>oO` | n, x | Optimizeï¼ˆæœ€é©åŒ–ï¼‰ |
| `<leader>oT` | n, x | Testï¼ˆãƒ†ã‚¹ãƒˆç”Ÿæˆï¼‰ |
| `<leader>oD` | n, x | Documentï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰ |
| `<leader>oR` | n, x | Reviewï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰ |
| `<leader>oS` | n, x | Security Audit |
| `<leader>oP` | n, x | Performance Profile |
| `<leader>oM` | n, x | Refactor Suggestions |
| `<leader>oY` | n, x | Type Safety Review |
| `<leader>oA` | n, x | Architecture Review |
| `<leader>oF` | n | Fix Diagnostics |
| `<leader>oG` | n | Review Git Diff |
| `<leader>oX` | n | Explain Diagnostics |
| `<leader>oN` | n | New Session |
| `<leader>oI` | n | Interrupt Session |
| `<leader>oK` | n | Compact Session |
| `<leader>oC` | n | Copy Messages |

--]]

-- ============================================================================
-- ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° / Troubleshooting
-- ============================================================================
--[[

## å•é¡Œ1: `snacks.nvim not found`

**è§£æ±ºç­–**:
LazyVimã«ã¯æ¨™æº–æ­è¼‰ã•ã‚Œã¦ã„ã‚‹ãŒã€æ˜ç¤ºçš„ã«ä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ :

```lua
dependencies = {
  { "folke/snacks.nvim", opts = { input = {}, picker = {}, terminal = {} } },
},
```

## å•é¡Œ2: `autoread not working`

**è§£æ±ºç­–**:
`~/.config/nvim/lua/config/options.lua` ã«è¿½åŠ :

```lua
vim.o.autoread = true
```

## å•é¡Œ3: OpenCode CLIãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ç¢ºèª**:
```bash
which opencode
# â†’ /opt/homebrew/bin/opencode
```

**è§£æ±ºç­–**:
è¨­å®šã«æ˜ç¤ºçš„ã«ãƒ‘ã‚¹ã‚’è¿½åŠ :

```lua
vim.g.opencode_opts = {
  opencode_path = "/opt/homebrew/bin/opencode",
}
```

## å•é¡Œ4: `@this` ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãŒæ©Ÿèƒ½ã—ãªã„

**åŸå› **:
é¸æŠç¯„å›²ãŒèªè­˜ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:
1. ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§é¸æŠ
2. `:OpencodePrompt @this` ã‚’å®Ÿè¡Œ
3. ã¾ãŸã¯é–¢æ•°ã§å®Ÿè¡Œ: `:lua require("opencode").prompt("@this")`

## å•é¡Œ5: ã‚­ãƒ¼ãƒãƒƒãƒ—ãŒå‹•ä½œã—ãªã„

**ç¢ºèª**:
```vim
:verbose map <leader>oa
```

**è§£æ±ºç­–**:
ä»–ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã®ç«¶åˆã‚’ç¢ºèªã—ã€ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒãƒƒãƒ—ã«å¤‰æ›´:

```lua
keys = {
  { "<C-g>a", function() require("opencode").ask("@this: ", {submit=true}) end },
},
```

## å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯

```vim
:checkhealth opencode
```

ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

--]]
